const board=document.getElementById('board');const status=document.getElementById('status');let scramble=null;let selected=null;let positions=[];const TILE_COUNT=64;async function init(){const res=await fetch('scramble.json');scramble=await res.json();positions=scramble.flat();render();}function render(){board.innerHTML='';for(let i=0;i<TILE_COUNT;i++){const tileId=positions[i];const el=document.createElement('div');el.className='tile';el.dataset.cell=i;el.dataset.tile=tileId;const img=document.createElement('img');img.src=`assets/tile_${String(tileId).padStart(2,'0')}.png`;img.alt=`Tile ${tileId}`;el.appendChild(img);el.addEventListener('click',onTileClick);board.appendChild(el);}status.textContent='Tiles scrambled. None are in the correct positions.';}function onTileClick(e){const el=e.currentTarget;const idx=Number(el.dataset.cell);if(selected===null){selected=idx;el.classList.add('selected');}else if(selected===idx){selected=null;el.classList.remove('selected');}else{const prev=document.querySelector(`.tile[data-cell='${selected}']`);prev.classList.remove('selected');swapTiles(selected,idx);selected=null;}}function swapTiles(a,b){const t=positions[a];positions[a]=positions[b];positions[b]=t;render();}document.getElementById('check').addEventListener('click',()=>{const centerCells=[];for(let r=3;r<=6;r++){for(let c=3;c<=6;c++){centerCells.push((r-1)*8 + (c-1));}}const correct=[19,20,21,22,27,28,29,30,35,36,37,38,43,44,45,46];let ok=true;for(let i=0;i<centerCells.length;i++){if(positions[centerCells[i]] !== correct[i]){ok=false;break;}}if(ok){status.textContent='Solved! The Ritual mark is aligned in the middle.';}else{status.textContent='Not solved yet. Keep going!';}});document.getElementById('shuffle').addEventListener('click',()=>{function deranged(arr){let a=arr.slice();for(let attempt=0;attempt<1000;attempt++){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}let ok=true;for(let i=0;i<a.length;i++) if(a[i]===i+1){ok=false;break;}if(ok) return a;}return a;}positions=deranged(positions);render();});document.getElementById('solve').addEventListener('click',()=>{positions=[];for(let i=0;i<TILE_COUNT;i++) positions.push(i+1);render();});init();